# Система резервного копирования данных

## Обзор

Система резервного копирования автоматически сохраняет все данные приложения (товары, категории, заказы, заявки) и восстанавливает их при необходимости.

## Как это работает

### Автоматическое резервное копирование
- При каждом деплое создается резервная копия всех данных
- Хранятся последние 5 резервных копий
- Старые копии автоматически удаляются

### Восстановление данных
- При запуске сервера автоматически проверяется наличие данных
- Если данные отсутствуют, система пытается восстановить их из последней резервной копии
- Если резервной копии нет, создаются начальные данные

## Использование

### Через админ панель
1. Войдите в админ панель
2. Перейдите на вкладку "Резервные копии"
3. Используйте кнопки для создания и восстановления резервных копий

### Через командную строку

#### Создание резервной копии
```bash
npm run backup:create
```

#### Восстановление из резервной копии
```bash
npm run backup:restore
```

#### Просмотр списка резервных копий
```bash
npm run backup:list
```

#### Автоматическое создание перед деплоем
```bash
npm run backup
```

## Структура файлов

```
server/
├── data/                    # Текущие данные
│   ├── products.json
│   ├── categories.json
│   ├── orders.json
│   ├── firmware-requests.json
│   ├── repair-requests.json
│   └── blog-posts.json
├── backup/                  # Резервные копии
│   ├── backup-2024-01-15T10-30-00-000Z/
│   │   ├── products.json
│   │   ├── categories.json
│   │   ├── orders.json
│   │   ├── firmware-requests.json
│   │   ├── repair-requests.json
│   │   ├── blog-posts.json
│   │   └── backup-info.json
│   └── ...
├── data-backup.js          # Скрипт управления резервными копиями
└── index.js                # Основной сервер
```

## API эндпоинты

### Создание резервной копии
```
POST /api/backup
```

### Восстановление из резервной копии
```
POST /api/backup/restore
```

### Получение списка резервных копий
```
GET /api/backup/list
```

## Рекомендации

1. **Перед деплоем**: Всегда создавайте резервную копию
2. **После деплоя**: Проверьте, что данные восстановились корректно
3. **Регулярно**: Проверяйте список резервных копий
4. **В случае проблем**: Используйте восстановление из резервной копии

## Безопасность

- Резервные копии хранятся локально на сервере
- Доступ к резервным копиям только через админ панель
- Автоматическая очистка старых копий экономит место

## Устранение неполадок

### Данные не восстанавливаются
1. Проверьте наличие резервных копий: `npm run backup:list`
2. Попробуйте восстановить вручную: `npm run backup:restore`
3. Проверьте права доступа к папкам

### Ошибка при создании резервной копии
1. Проверьте свободное место на диске
2. Убедитесь, что папка `server/backup` существует
3. Проверьте права на запись

### Сервер не запускается
1. Проверьте логи сервера
2. Убедитесь, что все файлы данных корректны
3. Попробуйте восстановить из резервной копии
